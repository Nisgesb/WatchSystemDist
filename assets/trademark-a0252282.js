import{r as Y,a as Z,b as F}from"./index-dae4084e.js";import{d as ee,r as u,b as ae,u as te,v as le,c as n,H as oe,o as b,e as V,g as t,w as l,i as y,I as re,j as T,h as d,f as ne,J as P,A as se,L as m}from"./index-4a914cf9.js";const de=["src"],ie=["src"],U=5,_e=ee({__name:"trademark",setup(ue){let p=u(1),L=u(0),h=u([]),k=u(0),i=u(!1),f=u("填入合作商信息"),o=ae({_id:"",brandName:"",brandLogo:""}),c=u(),v=u(!1);const q=te(),x=async e=>{v.value=!0;let a=await Y(e,U);L.value=a.totalCount,k.value=a.totalPage,h.value=a.data,v.value=!1},_=e=>{p.value=e,x(p.value)},N=()=>{i.value=!0},D=()=>{var e,a;o._id=0,o.brandName="",o.brandLogo="",f.value="填入合作商信息",(e=c.value)==null||e.clearValidate("brandName"),(a=c.value)==null||a.clearValidate("brandLogo"),N()},E=e=>{f.value="修改合作商信息",console.log(e),o._id=e._id,o.brandName=e.brandName,o.brandLogo=e.brandLogo,se(()=>{var a,r;(a=c.value)==null||a.clearValidate("brandName"),(r=c.value)==null||r.clearValidate("brandLogo")}),N()},$={brandName:[{required:!0,trigger:"blur",validator:(e,a,r)=>{a.trim().length>=1?r():r(new Error("品牌名称需大于等于一位"))}}],brandLogo:[{required:!0,validator:(e,a,r)=>{a?r():r(new Error("Logo图片必须上传"))}}]},z=async()=>{await c.value.validate(),i.value=!1;let e=await Z(o);console.log(o),e.code==200?m({type:"success",message:"提交成功！"}):m({type:"error",message:"服务器异常，请稍后重试"}),o._id&&o._id!==0?_(p.value):_(k.value)},B=e=>e.size/1024/1024<4?e.type=="image/jpeg"||e.type=="image/png"||e.type=="image/gif"||e.type=="image/webp"?!0:(m({type:"error",message:"上传文件格式必须为JPG、PNG、GIT、WEBP"}),!1):(m({type:"error",message:"上传文件大小必须小于4M"}),!1),S=(e,a)=>{console.log(e.imageUrl),o.brandLogo=e.imageUrl+"?imageMogr2/thumbnail/200x200>/format/webp/blur/1x0/quality/75",c.value.clearValidate("brandLogo")},G=async e=>{(await F(e)).code==200?(_(p.value),m({type:"success",message:"删除成功"})):m({type:"error",message:"服务器异常，请稍后重试"})};return le(()=>{x(1)}),(e,a)=>{const r=n("el-button"),g=n("el-table-column"),M=n("el-popconfirm"),j=n("el-table"),O=n("el-pagination"),R=n("el-card"),A=n("el-input"),C=n("el-form-item"),I=n("Plus"),J=n("el-icon"),H=n("el-upload"),W=n("el-form"),K=n("el-dialog"),Q=oe("loading");return b(),V("div",null,[t(R,{class:"box-card",shadow:"always"},{header:l(()=>[t(r,{type:"primary",icon:"Plus",onClick:D},{default:l(()=>[y(" 添加品牌合作商 ")]),_:1})]),default:l(()=>[re((b(),T(j,{border:"",data:d(h),"element-loading-text":"加载中..."},{default:l(()=>[t(g,{label:"序号",type:"index",width:"180",align:"center"}),t(g,{prop:"brandName",label:"品牌名称",align:"center"}),t(g,{prop:"brandLogo",label:"品牌Logo",align:"center"},{default:l(({row:s,$index:w})=>[ne("img",{src:s.brandLogo,style:{width:"100px",height:"100px"}},null,8,de)]),_:1}),t(g,{prop:"address",label:"品牌修改",align:"center",width:"180"},{default:l(({row:s,$index:w})=>[t(r,{type:"primary",size:"small",icon:"Edit",onClick:X=>E(s)},null,8,["onClick"])]),_:1}),t(g,{prop:"address",label:"品牌删除",align:"center",width:"180"},{default:l(({row:s,$index:w})=>[t(M,{title:`确认删除${s.brandName}品牌下的所有产品？`,width:"200",onConfirm:X=>G(s._id)},{reference:l(()=>[t(r,{type:"danger",size:"small",icon:"Delete"})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"])),[[Q,d(v)]]),t(O,{"current-page":d(p),"page-size":U,layout:"prev, pager, next, jumper, total","hide-on-single-page":"",total:d(L),onCurrentChange:_},null,8,["current-page","total"])]),_:1}),t(K,{modelValue:d(i),"onUpdate:modelValue":a[2]||(a[2]=s=>P(i)?i.value=s:i=s),title:d(f)},{footer:l(()=>[t(r,{onClick:a[1]||(a[1]=s=>P(i)?i.value=!1:i=!1)},{default:l(()=>[y("取消")]),_:1}),t(r,{type:"primary",onClick:z},{default:l(()=>[y("确认")]),_:1})]),default:l(()=>[t(W,{model:d(o),rules:$,ref_key:"formRef",ref:c},{default:l(()=>[t(C,{label:"品牌名称：","label-width":"100px",prop:"brandName"},{default:l(()=>[t(A,{style:{width:"50%"},modelValue:d(o).brandName,"onUpdate:modelValue":a[0]||(a[0]=s=>d(o).brandName=s)},null,8,["modelValue"])]),_:1}),t(C,{label:"品牌LOGO","label-width":"100px",prop:"brandLogo"},{default:l(()=>[t(H,{class:"avatar-uploader",action:"http://127.0.0.1:3000/upload/brandLogo",headers:{token:d(q).token},"show-file-list":!1,"on-success":S,"before-upload":B,name:"brandLogo"},{default:l(()=>[d(o).brandLogo?(b(),V("img",{key:0,src:d(o).brandLogo,class:"avatar"},null,8,ie)):(b(),T(J,{key:1,class:"avatar-uploader-icon"},{default:l(()=>[t(I)]),_:1}))]),_:1},8,["headers"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});export{_e as default};
