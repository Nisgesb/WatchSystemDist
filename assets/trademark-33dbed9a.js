import{r as Z,a as F,b as ee}from"./index-b80b8b8d.js";import{d as ae,r as u,b as te,u as oe,s as le,c as s,G as re,o as m,e as P,g as t,H as ne,h as r,w as o,i as h,I as se,j as v,f as de,n as U,J as q,z as ie,L as p}from"./index-0d643a49.js";const ue=["src"],ce=["src"],z=5,fe=ae({__name:"trademark",setup(me){let g=u(1),k=u(0),N=u([]),x=u(0),i=u(!1),y=u("填入合作商信息"),l=te({_id:"",brandName:"",brandLogo:""}),c=u(),L=u(!1);const b=oe(),C=async e=>{L.value=!0;let a=await Z(e,z);k.value=a.totalCount,x.value=a.totalPage,N.value=a.data,L.value=!1},f=e=>{g.value=e,C(g.value)},V=()=>{i.value=!0},D=()=>{var e,a;l._id=0,l.brandName="",l.brandLogo="",y.value="填入合作商信息",(e=c.value)==null||e.clearValidate("brandName"),(a=c.value)==null||a.clearValidate("brandLogo"),V()},E=e=>{y.value="修改合作商信息",console.log(e),l._id=e._id,l.brandName=e.brandName,l.brandLogo=e.brandLogo,ie(()=>{var a,n;(a=c.value)==null||a.clearValidate("brandName"),(n=c.value)==null||n.clearValidate("brandLogo")}),V()},S={brandName:[{required:!0,trigger:"blur",validator:(e,a,n)=>{a.trim().length>=1?n():n(new Error("品牌名称需大于等于一位"))}}],brandLogo:[{required:!0,validator:(e,a,n)=>{a?n():n(new Error("Logo图片必须上传"))}}]},$=async()=>{await c.value.validate(),i.value=!1;let e=await F(l);console.log(l),e.code==200?p({type:"success",message:"提交成功！"}):p({type:"error",message:"服务器异常，请稍后重试"}),l._id&&l._id!==0?f(g.value):f(x.value)},B=e=>e.size/1024/1024<4?e.type=="image/jpeg"||e.type=="image/png"||e.type=="image/gif"||e.type=="image/webp"?!0:(p({type:"error",message:"上传文件格式必须为JPG、PNG、GIT、WEBP"}),!1):(p({type:"error",message:"上传文件大小必须小于4M"}),!1),G=(e,a)=>{console.log(e.imageUrl),l.brandLogo=e.imageUrl+"?imageMogr2/thumbnail/200x200>/format/webp/blur/1x0/quality/75",c.value.clearValidate("brandLogo")},M=async e=>{(await ee(e)).code==200?(f(g.value),p({type:"success",message:"删除成功"})):p({type:"error",message:"服务器异常，请稍后重试"})};return le(()=>{C(1)}),(e,a)=>{const n=s("el-button"),_=s("el-table-column"),j=s("el-popconfirm"),O=s("el-table"),R=s("el-pagination"),I=s("el-card"),J=s("el-input"),w=s("el-form-item"),A=s("Plus"),H=s("el-icon"),W=s("el-upload"),K=s("el-form"),Q=s("el-dialog"),X=re("loading");return m(),P("div",null,[t(I,{class:"box-card",shadow:"always"},ne({default:o(()=>[se((m(),v(O,{border:"",data:r(N),"element-loading-text":"加载中..."},{default:o(()=>[t(_,{label:"序号",type:"index",width:"180",align:"center"}),t(_,{prop:"brandName",label:"品牌名称",align:"center"}),t(_,{prop:"brandLogo",label:"品牌Logo",align:"center"},{default:o(({row:d,$index:T})=>[de("img",{src:d.brandLogo,style:{width:"100px",height:"100px"}},null,8,ue)]),_:1}),r(b).buttons.includes("修改品牌")?(m(),v(_,{key:0,prop:"address",label:"品牌修改",align:"center",width:"180"},{default:o(({row:d,$index:T})=>[t(n,{type:"primary",size:"small",icon:"Edit",onClick:Y=>E(d)},null,8,["onClick"])]),_:1})):U("",!0),r(b).buttons.includes("删除品牌")?(m(),v(_,{key:1,prop:"address",label:"品牌删除",align:"center",width:"180"},{default:o(({row:d,$index:T})=>[t(j,{title:`确认删除${d.brandName}品牌下的所有产品？`,width:"200",onConfirm:Y=>M(d._id)},{reference:o(()=>[t(n,{type:"danger",size:"small",icon:"Delete"})]),_:2},1032,["title","onConfirm"])]),_:1})):U("",!0)]),_:1},8,["data"])),[[X,r(L)]]),t(R,{"current-page":r(g),"page-size":z,layout:"prev, pager, next, jumper, total","hide-on-single-page":"",total:r(k),onCurrentChange:f},null,8,["current-page","total"])]),_:2},[r(b).buttons.includes("添加品牌")?{name:"header",fn:o(()=>[t(n,{type:"primary",icon:"Plus",onClick:D},{default:o(()=>[h(" 添加品牌合作商 ")]),_:1})]),key:"0"}:void 0]),1024),t(Q,{modelValue:r(i),"onUpdate:modelValue":a[2]||(a[2]=d=>q(i)?i.value=d:i=d),title:r(y)},{footer:o(()=>[t(n,{onClick:a[1]||(a[1]=d=>q(i)?i.value=!1:i=!1)},{default:o(()=>[h("取消")]),_:1}),t(n,{type:"primary",onClick:$},{default:o(()=>[h("确认")]),_:1})]),default:o(()=>[t(K,{model:r(l),rules:S,ref_key:"formRef",ref:c},{default:o(()=>[t(w,{label:"品牌名称：","label-width":"100px",prop:"brandName"},{default:o(()=>[t(J,{style:{width:"50%"},modelValue:r(l).brandName,"onUpdate:modelValue":a[0]||(a[0]=d=>r(l).brandName=d)},null,8,["modelValue"])]),_:1}),t(w,{label:"品牌LOGO","label-width":"100px",prop:"brandLogo"},{default:o(()=>[t(W,{class:"avatar-uploader",action:"http://127.0.0.1:3000/upload/brandLogo",headers:{token:r(b).token},"show-file-list":!1,"on-success":G,"before-upload":B,name:"brandLogo"},{default:o(()=>[r(l).brandLogo?(m(),P("img",{key:0,src:r(l).brandLogo,class:"avatar"},null,8,ce)):(m(),v(H,{key:1,class:"avatar-uploader-icon"},{default:o(()=>[t(A)]),_:1}))]),_:1},8,["headers"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});export{fe as default};
