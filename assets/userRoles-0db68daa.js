import{d as fe,u as ge,r as R,s as be,P as he,c as o,o as n,e as N,g as t,w as e,f as k,h as T,j as f,i as d,n as Y,F as U,l as j,t as L,H as ve,Q as ye,L as w,R as ke,S as Ve,U as Ce,p as Re,k as Be,_ as Ne}from"./index-0d643a49.js";import{u as Se}from"./setting-73b75b97.js";const Z=$=>(Re("data-v-9bcb6521"),$=$(),Be(),$),Ue={class:"card-header"},we={class:"custom-tabs-label"},Ee=Z(()=>k("br",null,null,-1)),Ae=Z(()=>k("br",null,null,-1)),Fe={class:"descriptions-item-row"},Te={class:"buttonsCheckBox"},$e={key:0,style:{display:"flex","justify-content":"flex-end","margin-top":"20px"}},ze={class:"dialog-footer"},Me=fe({__name:"userRoles",setup($){const E=ge(),O=Se(),s=R([]),V=R({}),P=R(),W=R();R();const B=R(!1);R({pageId:[],buttonId:[]});const z=R({roleName:""}),x=(r,u)=>{},I=(r,u,a,_)=>{let l=s.value[r].pages[u];l.subPages.forEach((g,c)=>{let v=l.subPages[c]._id,C=l.subPages[c].buttons;if(_)V.value[v]||(V.value[v]=[...C],C.splice(0,C.length)),l.subPages[c].select=!0;else{if(V.value[v]){let A=V.value[v];C.splice(0,C.length,...A),delete V.value[v]}l.subPages[c].select=!1}})},ee=(r,u,a)=>{const _=s.value[r].pages[u],l=_.subPages[a]._id,g=_.subPages[a].buttons;if(_.select=_.subPages.every(c=>c.select),!V.value[l])V.value[l]=[...g],g.splice(0,g.length);else{const c=V.value[l];g.splice(0,g.length,...c),delete V.value[l]}},te=async()=>{try{(await ye(z.value.roleName)).code==200?(w({type:"success",message:"添加成功"}),B.value=!1):w({type:"error",message:"添加失败，请稍后重试"}),B.value=!1,O.refreshFlag=!O.refreshFlag}catch{w({type:"error",message:"添加失败，请稍后重试"}),B.value=!1}},le=(r,u)=>{let a=[],_=[];return s.value.find(g=>g._id===r).pages.forEach(g=>{g.subPages.forEach(c=>{c.buttons.length?(a.push(c._id),c.buttons.forEach(v=>{_.push(v._id)})):c.select&&a.push(c._id)})}),console.log({checkPages:a,checkButtons:_}),{checkPages:a,checkButtons:_}},se=(r,u)=>{ke.confirm("确定要修改该职位的限权？",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{let{checkPages:a,checkButtons:_}=le(r);(await Ve(r,a,_)).code==200?(w({type:"success",message:"修改成功！"}),D()):w({type:"error",message:"修改失败, 请稍后重试"})}).catch(a=>{w({type:"info",message:a.message})})},D=async()=>{const r=(await Ce()).roles;s.value=r,s.value.forEach(u=>{u.pages.forEach(a=>{let _=0;a.subPages.forEach(l=>{!l.buttons.length&&u.subPages.includes(l._id)&&(l.select=!0,_++)}),a.subPages.length===_&&(a.select=!0)})})};return be(async()=>{try{const r=await he();P.value=r,D()}catch(r){alert(r.message)}}),(r,u)=>{const a=o("el-button"),_=o("User"),l=o("el-icon"),g=o("el-text"),c=o("el-checkbox"),v=o("Check"),C=o("Close"),A=o("el-tag"),ae=o("el-checkbox-group"),oe=o("el-descriptions-item"),ne=o("el-descriptions"),H=o("el-tab-pane"),Q=o("el-tabs"),ue=o("el-col"),ce=o("el-card"),ie=o("Warning"),re=o("el-tooltip"),_e=o("el-input"),pe=o("el-form-item"),de=o("el-form"),me=o("el-dialog");return n(),N(U,null,[t(ce,{class:"box-card"},{header:e(()=>[k("div",Ue,[T(E).buttons.includes("添加角色")?(n(),f(a,{key:0,class:"button",onClick:u[0]||(u[0]=y=>B.value=!0)},{default:e(()=>[d("添加角色")]),_:1})):Y("",!0)])]),default:e(()=>[t(ue,{span:24},{default:e(()=>[t(Q,{"tab-position":"left",class:"demo-tabs",style:{height:"75vh"}},{default:e(()=>[(n(!0),N(U,null,j(P.value,(y,i)=>(n(),f(H,{key:y._id},{label:e(()=>[k("span",we,[t(l,{style:{"margin-right":"5px"}},{default:e(()=>[t(_)]),_:1}),k("span",null,L(y.permissionName),1)])]),default:e(()=>[t(g,{class:"mx-1",size:"large",tag:"b"},{default:e(()=>[d("页面限权  ")]),_:1}),t(g,{class:"mx-1",size:"small",type:"info"},{default:e(()=>[d("无限权角色无法打开该页面")]),_:1}),Ee,Ae,t(Q,{class:"inner-tabs"},{default:e(()=>[(n(!0),N(U,null,j(y.pages,(S,p)=>(n(),f(H,{class:"inner-tab-pane",label:S.label,key:S._id,stretch:!0},{default:e(()=>[k("div",null,[t(ne,{title:"设置页面对应的按钮权限",border:"",column:1,style:{"margin-top":"20px"}},ve({default:e(()=>[(n(!0),N(U,null,j(S.subPages,(m,b)=>(n(),f(oe,{align:"center",key:m._id},{label:e(()=>[d(L(m.label),1)]),default:e(()=>{var q,G;return[k("div",Fe,[k("div",Te,[(n(!0),N(U,null,j(m.buttons,(h,F)=>{var J,K;return n(),N(U,{key:h._id},[T(E).buttons.includes("修改角色限权")&&s.value[i]?(n(),f(ae,{key:0,disabled:s.value[i].pages[p].subPages[b].select,modelValue:s.value[i].pages[p].subPages[b].buttons,"onUpdate:modelValue":M=>s.value[i].pages[p].subPages[b].buttons=M,style:{display:"inline-flex","margin-right":"30px",height:"32px"}},{default:e(()=>[t(c,{label:h,size:"large"},{default:e(()=>[d(L(h.label),1)]),_:2},1032,["label"])]),_:2},1032,["disabled","modelValue","onUpdate:modelValue"])):(n(),f(A,{key:1,type:((K=(J=s.value[i])==null?void 0:J.pages[p].subPages[b].buttons[F])==null?void 0:K.buttonName)===h.buttonName?"":"info"},{default:e(()=>{var M,X;return[d(L(h.label)+" ",1),((X=(M=s.value[i])==null?void 0:M.pages[p].subPages[b].buttons[F])==null?void 0:X.buttonName)===h.buttonName?(n(),f(l,{key:0},{default:e(()=>[t(v)]),_:1})):(n(),f(l,{key:1},{default:e(()=>[t(C)]),_:1}))]}),_:2},1032,["type"]))],64)}),128))]),k("div",null,[T(E).buttons.includes("修改角色限权")&&s.value[i]?(n(),f(c,{key:0,modelValue:s.value[i].pages[p].subPages[b].select,"onUpdate:modelValue":h=>s.value[i].pages[p].subPages[b].select=h,onChange:h=>ee(i,p,b,S)},{default:e(()=>[d("页面只读")]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])):(n(),f(A,{key:1,type:(G=(q=s.value[i])==null?void 0:q.pages[p].subPages[b])!=null&&G.select?"":"info"},{default:e(()=>{var h,F;return[d(" 页面只读 "),(F=(h=s.value[i])==null?void 0:h.pages[p].subPages[b])!=null&&F.select?(n(),f(l,{key:0},{default:e(()=>[t(v)]),_:1})):(n(),f(l,{key:1},{default:e(()=>[t(C)]),_:1}))]}),_:2},1032,["type"]))])])]}),_:2},1024))),128))]),_:2},[T(E).buttons.includes("修改角色限权")&&s.value[i]?{name:"extra",fn:e(()=>[t(c,{modelValue:W.value,"onUpdate:modelValue":u[1]||(u[1]=m=>W.value=m),onChange:m=>x(i,p)},{default:e(()=>[d("全选按钮")]),_:2},1032,["modelValue","onChange"]),t(c,{modelValue:s.value[i].pages[p].select,"onUpdate:modelValue":m=>s.value[i].pages[p].select=m,onChange:m=>I(i,p,S,m)},{default:e(()=>[d("全选只读")]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),key:"0"}:{name:"extra",fn:e(()=>{var m;return[t(A,{type:(m=s.value[i])!=null&&m.pages[p].select?"":"info"},{default:e(()=>{var b;return[d(" 全部只读 "),(b=s.value[i])!=null&&b.pages[p].select?(n(),f(l,{key:0},{default:e(()=>[t(v)]),_:1})):(n(),f(l,{key:1},{default:e(()=>[t(C)]),_:1}))]}),_:2},1032,["type"])]}),key:"1"}]),1024),T(E).buttons.includes("修改角色限权")?(n(),N("div",$e,[t(a,{type:"primary",onClick:m=>se(y._id,S._id)},{default:e(()=>[d("提交")]),_:2},1032,["onClick"])])):Y("",!0)])]),_:2},1032,["label"]))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),t(me,{modelValue:B.value,"onUpdate:modelValue":u[4]||(u[4]=y=>B.value=y),width:"500px"},{header:e(()=>[d(" 创建角色 "),t(re,{effect:"dark",content:"只创建角色，分配限权功能请创建后设置",placement:"top"},{default:e(()=>[t(l,{style:{"margin-left":"4px"},size:12},{default:e(()=>[t(ie)]),_:1})]),_:1})]),footer:e(()=>[k("span",ze,[t(a,{onClick:u[3]||(u[3]=y=>B.value=!1)},{default:e(()=>[d("取消")]),_:1}),t(a,{type:"primary",onClick:te},{default:e(()=>[d(" 提交 ")]),_:1})])]),default:e(()=>[t(de,{model:z.value},{default:e(()=>[t(pe,{label:"角色名"},{default:e(()=>[t(_e,{modelValue:z.value.roleName,"onUpdate:modelValue":u[2]||(u[2]=y=>z.value.roleName=y),autocomplete:"off",style:{width:"330px"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])],64)}}});const Oe=Ne(Me,[["__scopeId","data-v-9bcb6521"]]);export{Oe as default};
