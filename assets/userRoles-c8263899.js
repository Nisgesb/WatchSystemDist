import{h as x,i as y,j as E,k as w}from"./index-ebc2234f.js";const I={class:"card-header"},B=Vue.createElementVNode("span",null,"限权分配： ",-1),R={class:"changeRole"},P={style:{float:"right"}},T={class:"dialog-footer"},S=Vue.defineComponent({__name:"userRoles",setup(M){let d=Vue.reactive([]),o=Vue.ref(!1);const u=Vue.reactive({roleName:""}),V=async()=>{try{(await E(u.roleName)).code==200?(ElementPlus.ElMessage({type:"success",message:"添加成功"}),o.value=!1):ElementPlus.ElMessage({type:"error",message:"添加失败，请稍后重试"}),o.value=!1}catch{ElementPlus.ElMessage({type:"error",message:"添加失败，请稍后重试"}),o.value=!1}},i={children:"children",label:"label",class:t=>t.level==1?"tree-level1":t.level==2?"tree-level2":"tree-level3"},r=Vue.reactive([]);let c=Vue.ref(!0);Vue.reactive([]);const s=Vue.reactive({pageId:[],buttonId:[]}),m=(t,e)=>{let l=[...e.checkedNodes,...e.halfCheckedNodes];s.buttonId.splice(0,s.buttonId.length),s.pageId.splice(0,s.pageId.length),l.forEach(n=>{n.level==3?s.buttonId.push(n._id):s.pageId.push(n._id)})},p=t=>{ElementPlus.ElMessageBox.confirm("确定要修改该职位的限权？",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{(await w(t,s.pageId,s.buttonId)).code==200&&ElementPlus.ElMessage({type:"success",message:"修改成功！"})}).catch(()=>{ElementPlus.ElMessage({type:"info",message:"修改已取消"})})},f=t=>{c.value=!1,c.value=!0},_=t=>{console.log(t);const e=[];return t.buttonId.forEach(l=>{e.push(l._id)}),e};return Vue.onMounted(async()=>{const t=await x();r.splice(0,r.length),t.forEach(l=>{r.push(l)}),(await y()).data.forEach(l=>{d.push(l)})}),(t,e)=>{const l=Vue.resolveComponent("el-button"),n=Vue.resolveComponent("el-tree"),h=Vue.resolveComponent("el-tab-pane"),C=Vue.resolveComponent("el-tabs"),g=Vue.resolveComponent("el-card"),v=Vue.resolveComponent("el-input"),k=Vue.resolveComponent("el-form-item"),N=Vue.resolveComponent("el-form"),b=Vue.resolveComponent("el-dialog");return Vue.openBlock(),Vue.createElementBlock("div",null,[Vue.createVNode(g,{class:"box-card"},{header:Vue.withCtx(()=>[Vue.createElementVNode("div",I,[Vue.createVNode(l,{class:"button",onClick:e[0]||(e[0]=a=>Vue.isRef(o)?o.value=!0:o=!0)},{default:Vue.withCtx(()=>[Vue.createTextVNode("添加角色")]),_:1})])]),default:Vue.withCtx(()=>[Vue.createVNode(C,{type:"border-card",onTabChange:f},{default:Vue.withCtx(()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(d),a=>(Vue.openBlock(),Vue.createBlock(h,{key:a._id,label:a.roleName},{default:Vue.withCtx(()=>[B,Vue.createElementVNode("div",R,[Vue.unref(c)?(Vue.openBlock(),Vue.createBlock(n,{key:0,data:r,"show-checkbox":"","node-key":"_id","default-expand-all":"","default-checked-keys":_(a),props:i,onCheck:m,"check-on-click-node":"","check-strictly":!1},null,8,["data","default-checked-keys"])):Vue.createCommentVNode("",!0)]),Vue.createElementVNode("div",P,[Vue.createVNode(l,{onClick:F=>p(a._id)},{default:Vue.withCtx(()=>[Vue.createTextVNode("修改限权")]),_:2},1032,["onClick"])])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),Vue.createVNode(b,{modelValue:Vue.unref(o),"onUpdate:modelValue":e[3]||(e[3]=a=>Vue.isRef(o)?o.value=a:o=a),title:"Shipping address"},{footer:Vue.withCtx(()=>[Vue.createElementVNode("span",T,[Vue.createVNode(l,{onClick:e[2]||(e[2]=a=>Vue.isRef(o)?o.value=!1:o=!1)},{default:Vue.withCtx(()=>[Vue.createTextVNode("取消")]),_:1}),Vue.createVNode(l,{type:"primary",onClick:V},{default:Vue.withCtx(()=>[Vue.createTextVNode(" 提交 ")]),_:1})])]),default:Vue.withCtx(()=>[Vue.createVNode(N,{model:u},{default:Vue.withCtx(()=>[Vue.createVNode(k,{label:"角色名"},{default:Vue.withCtx(()=>[Vue.createVNode(v,{modelValue:u.roleName,"onUpdate:modelValue":e[1]||(e[1]=a=>u.roleName=a),autocomplete:"off",style:{width:"330px"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});export{S as default};
