import{d as U,b as u,r as y,v as K,P as L,Q as $,c,o as m,e as C,g as n,w as a,f as p,J as b,i as h,F as j,l as D,h as k,j as N,n as J,R as Q,L as i,S as q,U as z}from"./index-4a914cf9.js";const G={class:"card-header"},H=p("span",null,"限权分配： ",-1),O={class:"changeRole"},W={style:{float:"right"}},X={class:"dialog-footer"},le=U({__name:"userRoles",setup(Y){let v=u([]),l=y(!1);const f=u({roleName:""}),x=async()=>{try{(await Q(f.roleName)).code==200?(i({type:"success",message:"添加成功"}),l.value=!1):i({type:"error",message:"添加失败，请稍后重试"}),l.value=!1}catch{i({type:"error",message:"添加失败，请稍后重试"}),l.value=!1}},I={children:"children",label:"label",class:t=>t.level==1?"tree-level1":t.level==2?"tree-level2":"tree-level3"},_=u([]);let g=y(!0);u([]);const r=u({pageId:[],buttonId:[]}),V=(t,e)=>{let o=[...e.checkedNodes,...e.halfCheckedNodes];r.buttonId.splice(0,r.buttonId.length),r.pageId.splice(0,r.pageId.length),o.forEach(d=>{d.level==3?r.buttonId.push(d._id):r.pageId.push(d._id)})},w=t=>{q.confirm("确定要修改该职位的限权？",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{(await z(t,r.pageId,r.buttonId)).code==200&&i({type:"success",message:"修改成功！"})}).catch(()=>{i({type:"info",message:"修改已取消"})})},R=t=>{g.value=!1,g.value=!0},B=t=>{console.log(t);const e=[];return t.buttonId.forEach(o=>{e.push(o._id)}),e};return K(async()=>{const t=await L();_.splice(0,_.length),t.forEach(o=>{_.push(o)}),(await $()).data.forEach(o=>{v.push(o)})}),(t,e)=>{const o=c("el-button"),d=c("el-tree"),E=c("el-tab-pane"),T=c("el-tabs"),F=c("el-card"),A=c("el-input"),M=c("el-form-item"),P=c("el-form"),S=c("el-dialog");return m(),C("div",null,[n(F,{class:"box-card"},{header:a(()=>[p("div",G,[n(o,{class:"button",onClick:e[0]||(e[0]=s=>b(l)?l.value=!0:l=!0)},{default:a(()=>[h("添加角色")]),_:1})])]),default:a(()=>[n(T,{type:"border-card",onTabChange:R},{default:a(()=>[(m(!0),C(j,null,D(k(v),s=>(m(),N(E,{key:s._id,label:s.roleName},{default:a(()=>[H,p("div",O,[k(g)?(m(),N(d,{key:0,data:_,"show-checkbox":"","node-key":"_id","default-expand-all":"","default-checked-keys":B(s),props:I,onCheck:V,"check-on-click-node":"","check-strictly":!1},null,8,["data","default-checked-keys"])):J("",!0)]),p("div",W,[n(o,{onClick:ee=>w(s._id)},{default:a(()=>[h("修改限权")]),_:2},1032,["onClick"])])]),_:2},1032,["label"]))),128))]),_:1})]),_:1}),n(S,{modelValue:k(l),"onUpdate:modelValue":e[3]||(e[3]=s=>b(l)?l.value=s:l=s),title:"Shipping address"},{footer:a(()=>[p("span",X,[n(o,{onClick:e[2]||(e[2]=s=>b(l)?l.value=!1:l=!1)},{default:a(()=>[h("取消")]),_:1}),n(o,{type:"primary",onClick:x},{default:a(()=>[h(" 提交 ")]),_:1})])]),default:a(()=>[n(P,{model:f},{default:a(()=>[n(M,{label:"角色名"},{default:a(()=>[n(A,{modelValue:f.roleName,"onUpdate:modelValue":e[1]||(e[1]=s=>f.roleName=s),autocomplete:"off",style:{width:"330px"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});export{le as default};
