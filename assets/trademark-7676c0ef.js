import{r as R,a as O,b as S}from"./index-5770eb2c.js";import"./index-ebc2234f.js";const j=["src"],A=["src"],v=5,Q=Vue.defineComponent({__name:"trademark",setup(I){let u=Vue.ref(1),V=Vue.ref(0),m=Vue.ref([]),p=Vue.ref(0),r=Vue.ref(!1),i=Vue.ref("填入合作商信息"),a=Vue.reactive({_id:"",brandName:"",brandLogo:""}),n=Vue.ref(),c=Vue.ref(!1);const g=async e=>{c.value=!0;let t=await R(e,v);V.value=t.totalCount,p.value=t.totalPage,m.value=t.data,c.value=!1},s=e=>{u.value=e,g(u.value)},f=()=>{r.value=!0},C=()=>{var e,t;a._id=0,a.brandName="",a.brandLogo="",i.value="填入合作商信息",(e=n.value)==null||e.clearValidate("brandName"),(t=n.value)==null||t.clearValidate("brandLogo"),f()},N=e=>{i.value="修改合作商信息",console.log(e),a._id=e._id,a.brandName=e.brandName,a.brandLogo=e.brandLogo,Vue.nextTick(()=>{var t,o;(t=n.value)==null||t.clearValidate("brandName"),(o=n.value)==null||o.clearValidate("brandLogo")}),f()},h={brandName:[{required:!0,trigger:"blur",validator:(e,t,o)=>{t.trim().length>=1?o():o(new Error("品牌名称需大于等于一位"))}}],brandLogo:[{required:!0,validator:(e,t,o)=>{t?o():o(new Error("Logo图片必须上传"))}}]},x=async()=>{await n.value.validate(),r.value=!1;let e=await O(a);console.log(a),e.code==200?ElementPlus.ElMessage({type:"success",message:"提交成功！"}):ElementPlus.ElMessage({type:"error",message:"服务器异常，请稍后重试"}),a._id&&a._id!==0?s(u.value):s(p.value)},w=e=>e.size/1024/1024<4?e.type=="image/jpeg"||e.type=="image/png"||e.type=="image/gif"||e.type=="image/webp"?!0:(ElementPlus.ElMessage({type:"error",message:"上传文件格式必须为JPG、PNG、GIT、WEBP"}),!1):(ElementPlus.ElMessage({type:"error",message:"上传文件大小必须小于4M"}),!1),y=(e,t)=>{a.brandLogo=e.imageUrl+"?imageMogr2/thumbnail/200x200>/format/webp/blur/1x0/quality/75",n.value.clearValidate("brandLogo")},k=async e=>{(await S(e)).code==200?(s(u.value),ElementPlus.ElMessage({type:"success",message:"删除成功"})):ElementPlus.ElMessage({type:"error",message:"服务器异常，请稍后重试"})};return Vue.onMounted(()=>{g(1)}),(e,t)=>{const o=Vue.resolveComponent("el-button"),d=Vue.resolveComponent("el-table-column"),L=Vue.resolveComponent("el-popconfirm"),E=Vue.resolveComponent("el-table"),P=Vue.resolveComponent("el-pagination"),T=Vue.resolveComponent("el-card"),B=Vue.resolveComponent("el-input"),_=Vue.resolveComponent("el-form-item"),M=Vue.resolveComponent("Plus"),q=Vue.resolveComponent("el-icon"),D=Vue.resolveComponent("el-upload"),$=Vue.resolveComponent("el-form"),z=Vue.resolveComponent("el-dialog"),U=Vue.resolveDirective("loading");return Vue.openBlock(),Vue.createElementBlock("div",null,[Vue.createVNode(T,{class:"box-card",shadow:"always"},{header:Vue.withCtx(()=>[Vue.createVNode(o,{type:"primary",icon:"Plus",onClick:C},{default:Vue.withCtx(()=>[Vue.createTextVNode(" 添加品牌合作商 ")]),_:1})]),default:Vue.withCtx(()=>[Vue.withDirectives((Vue.openBlock(),Vue.createBlock(E,{border:"",data:Vue.unref(m),"element-loading-text":"加载中..."},{default:Vue.withCtx(()=>[Vue.createVNode(d,{label:"序号",type:"index",width:"180",align:"center"}),Vue.createVNode(d,{prop:"brandName",label:"品牌名称",align:"center"}),Vue.createVNode(d,{prop:"brandLogo",label:"品牌Logo",align:"center"},{default:Vue.withCtx(({row:l,$index:b})=>[Vue.createElementVNode("img",{src:l.brandLogo,style:{width:"100px",height:"100px"}},null,8,j)]),_:1}),Vue.createVNode(d,{prop:"address",label:"品牌修改",align:"center",width:"180"},{default:Vue.withCtx(({row:l,$index:b})=>[Vue.createVNode(o,{type:"primary",size:"small",icon:"Edit",onClick:G=>N(l)},null,8,["onClick"])]),_:1}),Vue.createVNode(d,{prop:"address",label:"品牌删除",align:"center",width:"180"},{default:Vue.withCtx(({row:l,$index:b})=>[Vue.createVNode(L,{title:`确认删除${l.brandName}品牌下的所有产品？`,width:"200",onConfirm:G=>k(l._id)},{reference:Vue.withCtx(()=>[Vue.createVNode(o,{type:"danger",size:"small",icon:"Delete"})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"])),[[U,Vue.unref(c)]]),Vue.createVNode(P,{"current-page":Vue.unref(u),"page-size":v,layout:"prev, pager, next, jumper, total","hide-on-single-page":"",total:Vue.unref(V),onCurrentChange:s},null,8,["current-page","total"])]),_:1}),Vue.createVNode(z,{modelValue:Vue.unref(r),"onUpdate:modelValue":t[2]||(t[2]=l=>Vue.isRef(r)?r.value=l:r=l),title:Vue.unref(i)},{footer:Vue.withCtx(()=>[Vue.createVNode(o,{onClick:t[1]||(t[1]=l=>Vue.isRef(r)?r.value=!1:r=!1)},{default:Vue.withCtx(()=>[Vue.createTextVNode("取消")]),_:1}),Vue.createVNode(o,{type:"primary",onClick:x},{default:Vue.withCtx(()=>[Vue.createTextVNode("确认")]),_:1})]),default:Vue.withCtx(()=>[Vue.createVNode($,{model:Vue.unref(a),rules:h,ref_key:"formRef",ref:n},{default:Vue.withCtx(()=>[Vue.createVNode(_,{label:"品牌名称：","label-width":"100px",prop:"brandName"},{default:Vue.withCtx(()=>[Vue.createVNode(B,{style:{width:"50%"},modelValue:Vue.unref(a).brandName,"onUpdate:modelValue":t[0]||(t[0]=l=>Vue.unref(a).brandName=l)},null,8,["modelValue"])]),_:1}),Vue.createVNode(_,{label:"品牌LOGO","label-width":"100px",prop:"brandLogo"},{default:Vue.withCtx(()=>[Vue.createVNode(D,{class:"avatar-uploader",action:"http://127.0.0.1:3000/upload/brandLogo","show-file-list":!1,"on-success":y,"before-upload":w,name:"brandLogo"},{default:Vue.withCtx(()=>[Vue.unref(a).brandLogo?(Vue.openBlock(),Vue.createElementBlock("img",{key:0,src:Vue.unref(a).brandLogo,class:"avatar"},null,8,A)):(Vue.openBlock(),Vue.createBlock(q,{key:1,class:"avatar-uploader-icon"},{default:Vue.withCtx(()=>[Vue.createVNode(M)]),_:1}))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});export{Q as default};
